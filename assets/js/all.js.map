{"version":3,"sources":["all.js"],"names":["route","token","newData","tbody_table","document","querySelector","deleteAllOrder_btn","axios","get","headers","authorization","then","res","data","sort","a","b","getData","renderC3_allProduct","renderC3_allTitle","checkedData","forEach","cartItem","productItem","undefined","renderObj","Object","entries","chart","c3","generate","columns","type","onclick","d","i","console","log","onmouseover","onmouseout","donut","title","bindto","tbodyStr","item","time","moment","format","innerHTML","deleteOrder","e","index","target","getAttribute","splice","err","window","location","reload","alert","deleteAllOrder","changeOrderStatus","payResult","put","id","paid","Authorization","addEventListener","textContent","$","addClass","text","removeClass"],"mappings":"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","file":"all.js","sourcesContent":["const route = `rocket-frank`;\nconst token = `xWFBP5xYVHNDhUnNY6F5oYdQSIB3`;\nlet newData = [];\n// DOM => 表格內的tbody\nconst tbody_table = document.querySelector(`#tbody`);\n// DOM => 表格外的刪除所有訂單按鈕\nconst deleteAllOrder_btn = document.querySelector(`#deleteAllOrder`);\n\naxios\n  .get(\n    `https://livejs-api.hexschool.io/api/livejs/v1/admin/${route}/orders\n`,\n    {\n      headers: {\n        authorization: token,\n      },\n    }\n  )\n  .then((res) => {\n    newData = res.data[\"orders\"].sort((a, b) => {\n      return b[\"createdAt\"] - a[\"createdAt\"];\n    });\n    getData();\n    renderC3_allProduct();\n    renderC3_allTitle();\n  });\n\n// 函式 => 渲染整個類別營收C3\nfunction renderC3_allProduct() {\n  const checkedData = {};\n  newData.forEach((cartItem) => {\n    cartItem[\"products\"].forEach((productItem) => {\n      if (checkedData[productItem[\"category\"]] === undefined) {\n        checkedData[productItem[\"category\"]] = productItem[\"price\"];\n      } else {\n        checkedData[productItem[\"category\"]] += productItem[\"price\"];\n      }\n    });\n  });\n  const renderObj = Object.entries(checkedData);\n  var chart = c3.generate({\n    data: {\n      columns: renderObj,\n      type: \"donut\",\n      onclick: function (d, i) {\n        console.log(\"onclick\", d, i);\n      },\n      onmouseover: function (d, i) {\n        console.log(\"onmouseover\", d, i);\n      },\n      onmouseout: function (d, i) {\n        console.log(\"onmouseout\", d, i);\n      },\n    },\n    donut: {\n      title: \"全產品類別營收比重\",\n    },\n  });\n}\n\n// 函式 => 渲染整個品項營收C3\nfunction renderC3_allTitle() {\n  const checkedData = {};\n  newData.forEach((cartItem) => {\n    cartItem[\"products\"].forEach((productItem) => {\n      if (checkedData[productItem[\"title\"]] === undefined) {\n        checkedData[productItem[\"title\"]] = productItem[\"price\"];\n      } else {\n        checkedData[productItem[\"title\"]] += productItem[\"price\"];\n      }\n    });\n  });\n  const renderObj = Object.entries(checkedData);\n  var chart = c3.generate({\n    bindto: \"#chart1\",\n    data: {\n      columns: renderObj,\n      type: \"donut\",\n      onclick: function (d, i) {\n        console.log(\"onclick\", d, i);\n      },\n      onmouseover: function (d, i) {\n        console.log(\"onmouseover\", d, i);\n      },\n      onmouseout: function (d, i) {\n        console.log(\"onmouseout\", d, i);\n      },\n    },\n    donut: {\n      title: \"全品項營收比重\",\n    },\n  });\n}\n// 函式 => 渲染整個表格\nfunction getData() {\n  let tbodyStr = ``;\n  newData.forEach((item) => {\n    // !時間格式\n    let time = moment(item[\"createdAt\"], \"X\").format(\"YYYY-MM-DD\");\n    if (item[\"paid\"]) {\n      tbodyStr += `<tr>\n      <td>${item[\"id\"]}</td>\n      <td>\n        ${item[\"user\"][\"name\"]}<br />\n        ${item[\"user\"][\"tel\"]}\n      </td>\n      <td>${item[\"user\"][\"address\"]}</td>\n      <td>${item[\"user\"][\"email\"]}</td>\n      <td>${item[\"products\"][0][\"title\"]}</td>\n      <td>${time}</td>\n      <td><button id=\"changeStatusBtn\" data-id=${item[\"id\"]} paid-status=${item[\"paid\"]}  class=\"btn btn-success changeStatusBtn\">已處理</button></td>\n      <td><button id='deleteBtn' data-id=${item[\"id\"]} class=\"btn btn-delete\">刪除</button></td>\n    </tr>`;\n    } else {\n      tbodyStr += `<tr>\n      <td>${item[\"id\"]}</td>\n      <td>\n        ${item[\"user\"][\"name\"]}<br />\n        ${item[\"user\"][\"tel\"]}\n      </td>\n      <td>${item[\"user\"][\"address\"]}</td>\n      <td>${item[\"user\"][\"email\"]}</td>\n      <td>${item[\"products\"][0][\"title\"]}</td>\n      <td>${time}</td>\n      <td><button id=\"changeStatusBtn\" data-id=${item[\"id\"]} paid-status=${item[\"paid\"]}  class=\"btn btn-warning changeStatusBtn\">未處理</button></td>\n      <td><button id='deleteBtn' data-id=${item[\"id\"]} class=\"btn btn-delete\">刪除</button></td>\n    </tr>`;\n    }\n  });\n  tbody_table.innerHTML = tbodyStr;\n\n  // *訂單編號 => res.data[\"orders\"][0]['products'][0]['id']\n  // *聯絡人 => res.data['orders'][0]['user']['name']\n  // *電話 => res.data['orders'][0]['user']['tel']\n  // *聯絡地址 => res.data['orders'][0]['user']['address']\n  // *電子郵件 => res.data['orders'][0]['user']['email']\n  // *訂單品項 => res.data[\"orders\"][0][\"products\"][0][\"title\"]\n  // *訂單日期 => res.data[\"orders\"][0]['createdAt']\n}\n// 函式 => 刪除指定訂單\nfunction deleteOrder(e) {\n  newData.forEach((item, index) => {\n    if (item[\"id\"] === e.target.getAttribute(\"data-id\")) {\n      newData.splice(index, 1);\n    }\n  });\n  axios\n    .delete(\n      `https://livejs-api.hexschool.io/api/livejs/v1/admin/${route}/orders/${e.target.getAttribute(\n        \"data-id\"\n      )}`,\n      {\n        headers: {\n          authorization: token,\n        },\n      }\n    )\n    .then((res) => {\n      console.log(res.data);\n    })\n    .catch((err) => {\n      console.log(err);\n      window.location.reload();\n      alert(\"訂單刪除失敗\");\n    });\n}\n// 函式 => 刪除所有訂單\nfunction deleteAllOrder() {\n  // newData.forEach((item, index) => {\n  //   if (item[\"id\"] === e.target.getAttribute(\"data-id\")) {\n  //     newData.splice(index, 1);\n  //   }\n  // });\n  axios\n    .delete(\n      `https://livejs-api.hexschool.io/api/livejs/v1/admin/${route}/orders`,\n      {\n        headers: {\n          authorization: token,\n        },\n      }\n    )\n    .then((res) => {\n      console.log(res.data);\n      newData = [];\n      getData();\n    })\n    .catch((err) => {\n      console.log(err);\n      window.location.reload();\n      alert(\"訂單刪除失敗\");\n    });\n}\n// 函式 => 修改指定訂單的處理狀態\nfunction changeOrderStatus(e) {\n  // $('#changeStatusBtn').toggleClass(function(index){\n  //   console.log(index);\n  // });\n  // newData.forEach((item, index) => {\n  //   if (item[\"id\"] === e.target.getAttribute(\"data-id\")) {\n  //   }\n  // });\n\n  const payResult =\n    e.target.getAttribute(\"paid-status\") === \"true\" ? true : false;\n\n  axios\n    .put(\n      `https://livejs-api.hexschool.io/api/livejs/v1/admin/${route}/orders/`,\n      {\n        data: {\n          id: `${e.target.getAttribute(\"data-id\")}`,\n          paid: !payResult,\n        },\n      },\n      {\n        headers: {\n          Authorization: token,\n        },\n      }\n    )\n    .then((res) => {\n      console.log(res.data);\n    })\n    .catch((err) => {\n      console.log(err);\n      alert(\"訂單狀態更改失敗\");\n      getData();\n    });\n}\n\n// 監聽 => 監聽整個表格內容是否按到刪除鈕\ntbody_table.addEventListener(\"click\", (e) => {\n  if (e.target.id === `deleteBtn`) {\n    deleteOrder(e);\n    getData();\n  }\n  if (e.target.id === `changeStatusBtn`) {\n    changeOrderStatus(e);\n    if (e.target.textContent === \"未處理\") {\n      alert(\"狀態更改成功\");\n      $(e.target).addClass(\"btn-success\").text(\"已處理\");\n    } else {\n      alert(\"狀態更改成功\");\n      $(e.target)\n        .removeClass(\"btn-success\")\n        .addClass(\"btn-warning\")\n        .text(\"未處理\");\n    }\n  }\n});\n// 監聽 => 監聽表格外的刪除所有訂單按鈕\ndeleteAllOrder_btn.addEventListener(\"click\", (e) => {\n  console.log(123);\n  deleteAllOrder();\n});\n"]}